{% extends 'base.html' %}

{% block title %}Упражнение: ein/kein + Adjektiv + Substantiv{% endblock %}
{% block logo_and_title %}{% endblock %}

{% block content %}
<style>
    @keyframes blink-red {
      0%, 100% { background-color: inherit; }
      50% { background-color: #f87171; }
    }
    .blink-red {
      animation: blink-red 0.5s ease;
    }
</style>

<main class="container mx-auto p-4">
    <!-- Верхняя часть: условие -->
    {{ exercises.answer|json_script:"answer-data" }}
    <h2 class="text-2xl font-bold mb-4">Упражнение: ein/kein + Adjektiv (stark) + Substantiv + Kasus</h2>
    <p class="mb-6 text-lg font-semibold"><strong>Пример:</strong> kein gut Leute (Akkusativ)</p>
    <div class="flex justify-center items-center mb-4 gap-4 text-lg font-semibold">
        <div id="user-name" class="text-blue-700">{{ user.username }}</div>
        <div id="lifes" class="text-red-600">❤️ {{ user.lifes }}</div>
        <div id="score_all" class="text-red-600"> Всего баллов: {{ user.score }}</div>
        <div id="score" class="text-green-600">Баллы: {{ user.score }}</div>
    </div>

    <p class="text-2xl font-bold mb-4"><strong>Вопрос:</strong> {{exercises.question}}</p>
    <!-- Таблица с 3 столбцами -->
    <div class="overflow-x-auto">
        <table class="w-full border-collapse border border-gray-300 text-center">
            <thead class="bg-gray-100">
                <tr>
                    <th class="border border-gray-300 px-4 py-2 text-black">Artikel</th>
                    <th class="border border-gray-300 px-4 py-2 text-black">Adjektiv</th>
                    <th class="border border-gray-300 px-4 py-2 text-black">Substantiv</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="border border-gray-300 px-4 py-2 space-y-2 column-article">
                        {% for art in exercises.article_forms %}
                            <button class="bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700 w-24">
                                {{ art }}
                            </button><br>
                        {% endfor %}
                    </td>
                    <td class="border border-gray-300 px-4 py-2 space-y-2 column-adj">
                        {% for adjf in exercises.adj_forms %}
                            <button class="bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700 w-44">
                                {{adjf}}
                            </button><br>
                        {% endfor %}
                    </td>
                    <td class="border border-gray-300 px-4 py-2 space-y-2 column-noun">
                        {% for n in exercises.noun_forms %}
                            <button class="bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700 w-24">
                                {{n}}
                            </button><br>
                        {% endfor %}
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
<script>
document.addEventListener("DOMContentLoaded", () => {

    // Получаем ответ DTO
    const answer = JSON.parse(document.getElementById("answer-data").textContent);

    // Функция мигания красным
    function blinkRed(button){
        button.classList.add("blink-red");
        button.addEventListener("animationend", () => {
            button.classList.remove("blink-red");
        }, { once: true });
    }

    // Проверяем, была ли уже выбрана правильная кнопка в колонке
    function isColumnCorrect(columnSelector, correctValue){
        const buttons = document.querySelectorAll(columnSelector + " button");
        return Array.from(buttons).some(btn => btn.classList.contains("bg-green-500"));
    }

    // Проверка кнопки
    function checkAnswer(button, correctValue){
        const btnText = button.textContent.trim();
        if(btnText.toLowerCase() === correctValue.toLowerCase()){
            // Зеленая подсветка
            button.classList.remove("bg-blue-600","bg-blue-500");
            button.classList.add("bg-green-500");
            button.disabled = true;
        } else {
            blinkRed(button);
        }

        // Проверяем, выбраны ли правильные кнопки во всех колонках
        const allCorrect =
            isColumnCorrect(".column-article", answer.article) &&
            isColumnCorrect(".column-adj", answer.adj) &&
            isColumnCorrect(".column-noun", answer.noun);

        // Если все правильные выбраны, показываем блок действий
        if(allCorrect){
            const actionDiv = document.getElementById("exercise-actions");
            if(actionDiv) actionDiv.style.display = "flex"; // показываем блок
        }
    }

    // Навешиваем обработчики на кнопки
    document.querySelectorAll(".column-article button").forEach(btn =>
        btn.addEventListener("click", () => checkAnswer(btn, answer.article))
    );
    document.querySelectorAll(".column-adj button").forEach(btn =>
        btn.addEventListener("click", () => checkAnswer(btn, answer.adj))
    );
    document.querySelectorAll(".column-noun button").forEach(btn =>
        btn.addEventListener("click", () => checkAnswer(btn, answer.noun))
    );

});
</script>





<!-- Кнопки "Пройти ещё" и "Стоп", по умолчанию скрыты -->
<div id="exercise-actions" class="mt-6 flex flex-col sm:flex-row gap-4 justify-center" style="display: none;">
  <form method="post" action="{% url 'api:exercises:adjectivs_results_repeat' %}">
    {% csrf_token %}
    <input type="hidden" name="property_adjective" value="{{ exercises.property_adjective }}">
    <button type="submit" class="bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700">
      Пройти ещё
    </button>
  </form>

  <form method="post" action="{% url 'api:exercises:adjectivs_results_stop' %}">
    {% csrf_token %}
    <button type="submit" class="bg-red-600 text-white px-6 py-2 rounded hover:bg-red-700">
      Стоп
    </button>
  </form>
</div>


</main>





{% endblock %}
